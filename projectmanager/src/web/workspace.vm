<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
#load("project/resources")
#load_core_resources
	<title>#i18n("workspace.title") - DataLift</title>
#css_links
#header_links
</head>
<body ng-app="project">
#h_tetiere


<!-- IF CURRENT IS LOADED -->
#if($current)

<script type="text/javascript">
	var allProjects = "";
	var allLicenses = "";
	var currentProject = { uri : "$!esc.javascript($current.uri)", description: "$!esc.javascript($current.description)",  title : "$!esc.javascript($!{current.title})", license : "$!esc.javascript($licenses[$current.getLicense()].getLabel())", creation_date : "$!date.format('medium', $current.creationDate)", modification_date :  "$!date.format('medium', $current.modificationDate)" };
	
</script>
	<!-- ---------------- EDIT PROJECT -------------------- -->
<div class="container-fluid" id="projectSpaceContainer" ng-controller="projectController">
	<div class="span12 row-fluid">
		<h3 class="text-center">{{curProj.title}}</h3>
		<div class="row-fluid" style="margin-top: 20px;">
			<!-- DIV HISTOIRIQUE -->
			<div class="span3 border3">
				<h4 class="pagination-centered">#i18n("records")</h4>
				<div class="span12" style="border: solid #808080 1px; height: 500px">
					<div class="history-list" id=rss_feed style="color: #909090;">
						<!-- <p>Ici se trouvera l'historique des projets.</p> -->
						<!-- <h4>{{rssFeedTitle}}</h4>
						<ul>
							<li ng-repeat="rssItem in rssItems">
								<p>"{{rssItem.name}}"</p>
							</li>
						</ul>  -->
					</div>
				</div>
			</div>
			<!-- FIN DIV HISTOIRIQUE -->
			<!-- DIV CONTENT TAB ONGLET CONTAINER -->
			<div class="span9">
				<!-- LISTE ONGLET -->
				<ul class="nav nav-tabs tab_details">
					<li><a href="#suivi" data-toggle="tab">#i18n("tab.name.monitoring")</a></li>
					<li><a href="#description" data-toggle="tab">#i18n("tab.name.description")</a></li>
					<li class="active"><a href="#sources" data-toggle="tab">#i18n("tab.name.data")</a></li>
					<li><a href="#vocabulaires" data-toggle="tab">#i18n("tab.name.vocabulary")</a></li>
				</ul>
				<!-- FIN LISTE ONGLET -->
				<!-- DIV CONTENT TAB ONGLETS -->
				<div class="tab-content">
					<!-- ONGLET SUIVI -->
					<div class="tab-pane" id="suivi">
						<p>#i18n("tab.subtitle.monitoring")</p>
						<p class="red-message">Ici se trouvera l'historique du projet {{curProj.title}}</p>
					</div>
					<!-- FIN ONGLET SUIVI -->
					<!-- ONGLET DESCRIPTION -->
					<div class="tab-pane" id="description" style="height: 500px;">
				  		<p>#i18n("project.description") : </p>
				  		<p>{{curProj.description}}</p>
			  			<p>#i18n("project.license") : </p><p>{{curProj.license}} </p><br/>
						<!--<p style="display:inline-block;">Créé par:&nbsp</p>
						<p style="display:inline-block;">{{curProj.owner}}</p><br/> -->
						<p style="display:inline-block;">#i18n("project.creation_s")</p>
						<p style="display:inline-block;">{{curProj.creation_date}}</p><br/>
						<p style="display:inline-block;">#i18n("project.modification_s")</p>
						<p style="display:inline-block;">{{curProj.modification_date}}</p><br/>
						<div class="span12 actionBtn" id="description-btn">
							<button id="popoverRemove" class="btn btn-custom-blue" 
								rel="popover" data-placement="top" data-trigger="hover"href="#modifyproject" data-toggle="modal">#i18n("modify")
							</button>
							
							<button id="popoverRemove" class="action btn btn-custom-red" data-content="Supprimez le projet sélectionné" 
								rel="popover" data-placement="top" data-trigger="hover" href="#deleteProject" data-toggle="modal">#i18n("delete")
							</button>
						</div>
				  	</div>
				  	<!-- FIN ONGLET DESCRIPTION -->
				  	<!-- ONGLET SOURCES -->
				  	<div class="tab-pane active tab-sub-menu" id="sources">
						<div class="list-group">
							#foreach ($curSource in $current.getSources())
							
								<li class="divider-group-list row-fluid">
									<a href="#" ng-click="applicableModules('$current.uri', '$curSource.uri')">$curSource.title</a>
									<a href="#deleteSource" role="button" class="pull-right" data-toggle="modal" style="display: inline-block">
										<img src="${baseUri}/images/icon-delete.png" ng-click="deleteSource('$current.uri', '${curSource.uri}', '${baseUri}')">
									</a>
									<a href="$curSource.uri" class="pull-right" style="display: inline-block; margin-right: 20px;">
										<img src="${baseUri}/images/icon-edit.png">
									</a>
								</li>
							
							#end
						</div>
						
							<a href="{{curProj.uri}}/srcupload" role="button" class="btn" style="margin-top: 1em;">
								<img src="${baseUri}/images/icon-add.png" class="icon">#i18n("source.button.add")
							</a>
						
				  	</div>
				  	<!-- FIN ONGLET SOURCES -->
				  	<!-- ONGLET ONTOLOGIES -->
				  	<div class="tab-pane tab-sub-menu" id="vocabulaires">
						<div class="list-group" style="max-height: 100px:">
						#foreach ($curOnto in $current.getOntologies())
							<ul>
								<li class="divider-group-list row-fluid">
									<a href="${curOnto.title}">$curOnto.title</a>	
									<a href="#deleteOnto" role="button" class="pull-right" data-toggle="modal" style="display: inline-block" ng-click="deleteOntology('$current.uri', '$curOnto.title')">
										<img src="${baseUri}/images/icon-delete.png">
									</a>
								</li>
							</ul>
						#end
						</div>
						
						<a href="{{curProj.uri}}/ontologyupload" role="button" class="btn">
							<img src="${baseUri}/images/icon-add.png">
							#i18n("ontology.button.add")
						</a>
						
				  	
				  	</div>
				  	<!-- FIN ONGLET ONTOLOGIES -->
			  	</div>
			  	<!-- FIN DIV CONTENT TAB ONGLETS -->
			</div>
			<!-- FIN DIV CONTENT TAB ONGLETS CONTAINER -->
		</div>
	</div>

	<!-- DIV POPUP REMOVE PROJECT -->
	
	<form method="post" action="${current.uri}?_method=DELETE" class="form_formated" name="delete_project">
		<input type="hidden"  id="delete" value="#i18n("delete")"/>
	</form>
	
	<div class="modal hide pagination-centered fade" id="deleteProject">
	  	<div class="modal-header"> <a class="close" data-dismiss="modal">×</a>
		    <h3>#i18n("delete")</h3>
	  	</div>
		<div class="modal-body">
		   	<p>#i18n("project.message.delete_project")</p>
	 	</div>
		<div class="modal-footer">
			<button href="#" class="btn btn-custom-blue" data-dismiss="modal">#i18n("cancel")</button>
	    	<button class="btn btn-custom-red" data-dismiss="modal" onclick="document.forms['delete_project'].submit();  return false;">#i18n("delete")</button>
	  	</div>
	</div>
	<!-- FIN DIV POPUP REMOVE PROJECT -->
	<!-- DIV POPUP MODIFY PROJECT 
	<div class="modal hide pagination-centered fade" id="modifyProject">
	  	<div class="modal-header"> <a class="close" data-dismiss="modal">×</a>
		    <h3>Modifier</h3>
	  	</div>
		<div class="modal-body">
		   	<span>Modification du projet <p class="brand">{{curProj.title}}</p></span>
	 	</div>
		<div class="modal-footer">
			<button class="btn btn-custom-grey" data-dismiss="modal">Annuler</button>
	    	<button href="${current.uri}/modify" class="btn btn-custom-blue">#i18n("modify")</button>
	  	</div>
	</div>
	 FIN DIV POPUP MODIFY PROJECT -->
	 
	 <!-- MODIFY PROJECT -->
	#set( $to_redirect = "${baseUri}/project/$")
	#if( $current )
		#set( $title_m  = "project.title.modify_project" )
		#set( $submit = "modify" )
      	#set( $target = "$current.uri" )
	#else
		#set( $title_m = "project.title.new_project" )
		#set( $submit = "create" )
      	#set( $target = "${baseUri}/project" )
	#end
	<div class="modal hide pagination-centered fade in" id="modifyproject">
	  	<div class="modal-header"> <a class="close" data-dismiss="modal">×</a>
	    	<h3>#i18n("project.title.mofidy_project")</h3>
	  	</div>
	  	<div class="modal-body">
	    	<form method="get" action="" id="create" class="form-horizontal">
		  	<div class="control-group">
		    	<label class="control-label" for="title">#i18n("project.name"):</label>
			    <div class="controls">
			      <input onkeyup="change(this);" style="width: 36em;" type="text" id="title" name="title" placeholder="$!current.title" autofocus="autofocus">
			    </div>
		  	</div>
		  	<div class="control-group">
		  		<label class="control-label" for="license">#i18n("project.license"): </label>
			  	<div class="controls">
				    <select id="license" name="license" style="width: 37em;">
						#foreach ( $li in $licenses )
							<p>$li.uri</p>
							<option value="$li.uri" #if($li.uri == $current.license) selected="selected" #end>$!esc.html($li.label)</option>
						#end
					</select>
				</div>
		  	</div>
		  	<div class="control-group">
			    <label class="control-label" for="description">#i18n("project.description"): </label>
			    <div class="controls">
			      <textarea cols=100 rows=13 style="width: 36em;" type="text" id="modify_description" placeholder="$!current.description"></textarea>
			    </div>
		  	</div>
			</form>
	  	</div>
		<div class="modal-footer">
			<button class="btn btn-custom-grey" data-dismiss="modal" aria-hidden="true">#i18n("cancel")</button>
		    <button id="FormSubmit" type="submit" class="btn btn-custom-blue">#i18n("modify")</button>
		    <input type="hidden" value="$target" id="target"></input>
	  	</div>
	</div>
#script_links
<script type="text/javascript">
$('#FormSubmit').click(function(e){
	e.preventDefault();
	
	var success = false;
	var target = ($('#target').val());
	var formValue = ($('#create').val());
	var description = ($('#modify_description').val());
	var title = ($('#title').val());
	var license = ($('#license').val());
	var toRedirect = "$to_redirect";	
	console.log(description);
	$.post(target, {"license": license, "description": description, "title": title})
	.done(function(data, status, xhr) {
		window.open("$target", '_self',false);
	})
	.fail(function() {
	alert( "An error occured when trying to create the project." );
	});
});
function change (el) {
	var max_len = 60;
	if (el.value.length > max_len) {
		el.value = el.value.substr(0, max_len);
		}
	document.getElementById('char_cnt').innerHTML = el.value.length;
	document.getElementById('chars_left').innerHTML = max_len - el.value.length;
	return true;
	}
</script>	 
<!-- MODIFY PROJECT -->
	 
	 
	 
	 
	 
	<!-- DIV POPUP MODIFY SOURCE -->
	<div class="modal hide pagination-centered fade" id="modifySource">
	  	<div class="modal-header"> <a class="close" data-dismiss="modal">×</a>
		    <h3>Modifier</h3>
	  	</div>
		<div class="modal-body">
		   	<p>Modification d'un jeux de données</p>
	 	</div>
		<div class="modal-footer">
			<button class="btn btn-custom-grey" data-dismiss="modal">Annuler</button>
	    	<button data-dismiss="modal" class="btn btn-custom-blue">Modifier</button>
	  	</div>
	</div>
	<!-- FIN DIV POPUP MODIFY ONTOLOGIE -->
	
	<!-- DIV POPUP AJOUTER UNE NOUVELLE ONTOLOGIE -->
	<div class="modal hide pagination-centered fade large" id="addOntologie">
	  	<div class="modal-header"> <a class="close" data-dismiss="modal">×</a>
	    	<h3>Nouvelle Ontologie</h3>
	  	</div>
	  	<div class="modal-body">
	    	<p>Ajouter une nouvelle ontologie</p>
	    	<input type="text" id="ontology-title" name="title" placeholder="Nom de l'ontologie" autofocus>
	    	<input type="text" id="ontology-cource-url" name="source-url" placeholder="Url de l'ontologie">
	  	</div>
	  	<div class="modal-footer">
		    <a href="#" class="btn" data-dismiss="modal">Annuler</a>
		    <button class="btn btn-primary" ng-click="uploadOntology('$current.uri')">Créer</button>
	  	</div>
	</div>
	<!-- FIN DIV POPUP AJOUTER UNE NOUVELLE ONTOLOGIE -->
	
	<!-- DIV POPUP SUPPRIMER UNE ONTOLOGIE -->
	<div class="modal hide pagination-centered fade large" id="deleteOntologie">
	  	<div class="modal-header"> <a class="close" data-dismiss="modal">×</a>
	    	<h3>Supprimer</h3>
	  	</div>
	  	<div class="modal-body">
	    	<p>Etes-vous sûr de vouloir supprimer ce vocabulaire ?</p>
	  	</div>
	  	<div class="modal-footer">
		    <a href="#" class="btn" data-dismiss="modal">Annuler</a>
		    <a href="#" data-dismiss="modal" class="btn btn-primary btn-custom-red">Supprimer</a>
	  	</div>
	</div>
	<!-- FIN DIV POPUP AJOUTER UNE NOUVELLE ONTOLOGIE -->
<!-- ---------------- FIN EDIT PROJECT -------------------- -->
</div>
#h_footer
<script type="text/javascript">
jQuery(function() {

    jQuery.getFeed({
        url: currentProject.uri+'/feed',
        success: function(feed) {
        
            jQuery('#rss_feed').append('<h4 class="pagination-centered">'
            + feed.title
            + '</h4>');
            
            var html = '';
            
            for(var i = 0; i < feed.items.length && i < 5; i++) {
            
                var item = feed.items[i];
                
                html += '</br></br><a href="'
                + item.link
                + '">'
                + item.title
                + '</a>';
                
                html += '<div class="updated">'
                + item.id
                + '</div>';
                
				var rssJSONparse = jQuery.parseJSON(item.description);
                console.log(rssJSONparse);
                
                for (j = 0 ; j < rssJSONparse.length ; j++)
                	{
                		html += '<div class="updated">'
                		+ rssJSONparse[j].name;
                		+ '</div> </br>';
                		
                		html += '<div class="updated">'
                    		+ rssJSONparse[j].value;
                    		+ '</div></br>';
                	}
            }
            
            jQuery('#rss_feed').append(html);
        }    
    });
});

</script> 
#else
<!-- ---------------- PROJECT SAPCE -------------------- -->
<!-- if CURRENT IS NOT LOADED  --> 

<script type="text/javascript">
var currentProject = "";
	var allProjects = [
#foreach ($item in $it)
       { uri : "$esc.javascript($!{item.uri})", description : "$!esc.javascript($item.description)", title : "$esc.javascript($!{item.title})", license : "$!esc.javascript($licenses[$item.getLicense()].getLabel())", owner :  "$esc.javascript($item.owner)", creation_date : "$!date.format('medium', $item.creationDate)", modification_date : "$!date.format('medium', $item.modificationDate)" },
       				#end];
	 
	
	var  allLicenses = [];
	allLicenses.push({license : ""});
	#foreach ($li in $licenses)
		allLicenses.push({ license : "$!esc.javascript($li.label)"});
	#end
	
</script>

<div class="span12 row-fluid projectSpaceContainer" ng-controller="projectController">
	<div class="span12 row-fluid" style="margin:0 auto; float:none;">
		<div class="span3 row" id="btnActionDiv">
			<div id="new-projet-btn">
				<button id="add_project" href="#createproject" role="button" class="btn" data-toggle="modal"><img class="icon" src="${baseUri}/images/icon-add.png">#i18n("project.title.new_project")</button>
			</div>
		</div>
		
		<!-- DIV BAR DE FILTRES --> 
		<div class="span9 row" style="margin:0 auto; float:none;">
			<form class="navbar-search form-inline pagination-centered">
	  			<label class="search_label_width">#i18n("search_filter")</label>
	  			<input type="search" ng-model="projectfilter" placeholder="Search filter..."/>
				<label class="search_label_width">#i18n("project.license")</label>
				<select ng-model="licenseselected" ng-options="l.license for l in licenses">
				</select>
			</form>
		</div>
		 <!-- FIN DIV BAR DE FILTRES -->
	</div>
	<div class="list-group offset2 row span8" id="project-list"> 
		<ul class="nav nav-stacked" id="ul-project-list">
			<li ng-repeat="project in projects | filter:projectfilter | filter:licenseselected">
				<a href="{{ project.uri }}">
					<div class="span12 list-elem">
						<span class="span7">
						 	<img src="${baseUri}/images/Project-img.png" id="img-nav-stacked"><span>{{ project.title }}</span><br>
						 	<span class="info-list-title">#i18n("project.description") :</span>
							<span class="info-list">{{ project.description }} </span><br>
							<span class="info-list-title">#i18n("project.license") :</span>
							<span class="info-list"> {{ project.license }}</span>
						</span>
						<span class="span5 creater-block">
							<!-- <span>#i18n("project.creation_by"):&nbsp</span>
							<span>{{ project.owner }}</span><br>  -->
							<span>#i18n("project.creation_s")</span>
							<span>{{ project.creation_date }}</span><br>
							<span>#i18n("project.modification_s") </span>
							<span>{{ project.modification_date }}</span><br>
						</span>
					</div>
				</a>
			</li>
		</ul> 
	</div>
	<!-- DIV POPUP FORM -->
	#set( $to_redirect = "${baseUri}/project")
	#if( $current )
		#set( $title_m  = "project.title.modify_project" )
		#set( $submit = "modify" )
      	#set( $target = "${it.uri}" )
	#else
		#set( $title_m = "project.title.new_project" )
		#set( $submit = "create" )
      	#set( $target = "${baseUri}/project" )
	#end
	<div class="modal hide pagination-centered fade in" id="createproject">
	  	<div class="modal-header"> <a class="close" data-dismiss="modal">×</a>
	    	<h3>#i18n("project.title.new_project")</h3>
	  	</div>
	  	<div class="modal-body">
	    	<form method="get" action="" id="create" class="form-horizontal">
		  	<div class="control-group">
		    	<label class="control-label" for="title">#i18n("project.name"):</label>
			    <div class="controls">
			      <input onkeyup="change(this);" style="width: 36em;" type="text" id="title" name="title" value="$!esc.html($it.title_m)" placeholder="Nom du projet" autofocus="autofocus">
			    </div>
		  	</div>
		  	<div class="control-group">
		  		<label class="control-label" for="license">#i18n("project.license"): </label>
			  	<div class="controls">
				    <select id="license" name="license" style="width: 37em;">
						#foreach ( $li in $licenses )
							<p>$li.uri</p>
							<option value="$li.uri" #if($li.uri == $it.license) selected="selected" #end>$esc.html($li.label)</option>
						#end
					</select>
				</div>
		  	</div>
		  	<div class="control-group">
			    <label class="control-label" for="description">#i18n("project.description"): </label>
			    <div class="controls">
			      <textarea cols=100 rows=13 style="width: 36em;" type="text" id="description" value="$!esc.html($it.description)"></textarea>
			    </div>
		  	</div>
			</form>
	  	</div>
		<div class="modal-footer">
			<button class="btn btn-custom-grey" data-dismiss="modal" aria-hidden="true">#i18n("cancel")</button>
		    <button id="FormSubmit" type="submit" class="btn btn-custom-blue">#i18n("create")</button>
		    <input type="hidden" value="$target" id="target"></input>
	  	</div>
	</div>
#script_links
<script type="text/javascript">
$('#FormSubmit').click(function(e){
	e.preventDefault();
	
	var success = false;
	var target = ($('#target').val());
	var formValue = ($('#create').val());
	var description = ($('#description').val());
	var title = ($('#title').val());
	var license = ($('#license').val());
	var toRedirect = "$to_redirect";							
	$.post(target, {"license": license, "description": description, "title": title})
	.done(function(data, status, xhr) { 
		window.open(xhr.getResponseHeader('Location'), '_self',false);
	})
	.fail(function(data, status, xhr) {
		alert(data.responseText);
	});
});

function change (el) {
	var max_len = 60;
	if (el.value.length > max_len) {
		el.value = el.value.substr(0, max_len);
		}
	document.getElementById('char_cnt').innerHTML = el.value.length;
	document.getElementById('chars_left').innerHTML = max_len - el.value.length;
	return true;
	}

</script>
</div>
#h_footer
#end
</body>
</html>
